# roles/standalone-dns/templates/docker-compose.yml.j2

services:
  technitium:
    image: {{ standalone_dns_image }}
    container_name: standalone-technitium
    hostname: standalone-technitium
    restart: unless-stopped

    # We want Technitium to bind directly to host :53 (TCP+UDP)
    network_mode: host

    environment:

      # Informational identity
      DNS_SERVER_DOMAIN: "{{ standalone_dns_server_domain }}"

      # Admin password for web UI
      DNS_SERVER_ADMIN_PASSWORD: "{{ technitium_admin_password }}"

      # Web console ports
      DNS_SERVER_WEB_SERVICE_HTTP_PORT: "{{ standalone_dns_web_http_port }}"
      DNS_SERVER_WEB_SERVICE_HTTPS_PORT: "{{ standalone_dns_web_https_port }}"
      DNS_SERVER_WEB_SERVICE_ENABLE_HTTPS: "true"

      # Forwarders & protocol
      DNS_SERVER_FORWARDERS: "{{ standalone_dns_forwarders }}"

      # Optional nice-to-haves
      DNS_SERVER_ENABLE_BLOCKING: "true"
      DNS_SERVER_LOG_USING_LOCAL_TIME: "true"

      # NOTE: Because this isn't an HA instance that will require a VIP we will rely on Technitium defaults for DNS listen addresses
      # it will bind 0.0.0.0:53 and [::]:53 inside the host namespace.

    volumes:
      # Technitium config directory (auth, zones, settings, etc.)
      - "{{ standalone_dns_root }}/technitium:/etc/dns"